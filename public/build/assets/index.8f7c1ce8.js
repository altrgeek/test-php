import{j as a,a as l,h as J,c as y,r as m,u as g,l as R,s as K,b as V,d as X,p as O,e as u,f as w,g as ee,i as ae,k as te,m as M,n as D,o as ie,q as re,t as ne}from"./index.e7ce09ac.js";import{g as se}from"./_commonjsHelpers.b8add541.js";const le=({id:e,title:r="Untitled popup",submitLabel:i="Submit",cancelLabel:t="Discard",onSubmit:n,onCancel:s,disabled:d,children:f})=>{const h=c=>{c.preventDefault(),s&&s(c),jQuery(`#${e}`).modal("hide")};return a("div",{className:"modal fade opened toggled visible",id:e,children:a("div",{className:"modal-dialog modal-md",role:"document",children:l("div",{className:"modal-content",children:[l("div",{className:"modal-header",children:[a("div",{className:"modal-title",children:r}),a("a",{href:"#",className:"close","aria-label":"Close",onClick:J(e),children:a("em",{className:"icon ni ni-cross"})})]}),a("div",{className:"modal-body",children:a("div",{className:"form-validate is-alter",children:l("div",{className:"row gx-4 gy-3",children:[f,a("div",{className:"col-12",children:l("ul",{className:"d-flex justify-content-between gx-4 mt-1",children:[a("li",{children:a("button",{id:"addEvent",type:"submit",className:"btn btn-primary",disabled:d,onClick:n,children:i})}),a("li",{children:a("button",{type:"button",id:"resetEvent",className:"btn btn-danger btn-dim",onClick:h,children:t})})]})})]})})})]})})})},ce=({label:e,width:r="full",children:i})=>a("div",{className:y({"col-12":r==="full","col-6":r==="half"}),children:l("div",{className:"form-group",children:[e&&a("div",{className:"form-label",children:e}),a("div",{className:"form-control-wrap",children:i})]})}),de=({id:e="createChatGroupModal",title:r="Create new group"})=>{const[i,t]=m.exports.useState("");return a(le,{id:e,title:r,children:a(ce,{children:a("input",{type:"text",className:"form-control",onChange:n=>t(n.target.value),value:i,required:!0})})})},oe=()=>{const e=g(),[r,i]=m.exports.useState(""),t=m.exports.useCallback(R.exports.debounce(n=>{e(n?K(n):V())},1e3),[R.exports.debounce]);return m.exports.useEffect(()=>{t(r)},[r,t]),a("div",{className:"nk-chat-aside-search",children:a("div",{className:"form-group",children:l("div",{className:"form-control-wrap",children:[a("div",{className:"form-icon form-icon-left",children:a("em",{className:"icon ni ni-search"})}),a("input",{type:"text",className:"form-control form-round",onChange:n=>i(n.target.value),value:r,placeholder:"Search by name"})]})})})},he=({children:e})=>l("div",{className:"nk-chat-aside-body","data-simplebar":"init",children:[l("div",{className:"simplebar-wrapper",style:{margin:0},children:[a("div",{className:"simplebar-height-auto-observer-wrapper",children:a("div",{className:"simplebar-height-auto-observer"})}),a("div",{className:"simplebar-mask",children:a("div",{className:"simplebar-offset",style:{right:0,bottom:0},children:a("div",{className:"simplebar-content-wrapper",style:{height:"100%",overflow:"hidden scroll"},children:l("div",{className:"simplebar-content",style:{padding:0},children:[a(oe,{}),e]})})})}),a("div",{className:"simplebar-placeholder",style:{width:"auto",height:"664px"}})]}),a("div",{className:"simplebar-track simplebar-horizontal",style:{visibility:"hidden"},children:a("div",{className:"simplebar-scrollbar",style:{width:0,display:"none"}})}),a("div",{className:"simplebar-track simplebar-vertical",style:{visibility:"visible"},children:a("div",{className:"simplebar-scrollbar",style:{height:"130px",transform:"translate3d(0px, 0px, 0px)",display:"block"}})})]}),me=()=>a("div",{className:"chat-actions",children:l("div",{className:"dropdown",children:[a("a",{href:"#",className:"btn btn-icon btn-sm btn-trigger dropdown-toggle","data-toggle":"dropdown",children:a("em",{className:"icon ni ni-more-h"})}),a("div",{className:"dropdown-menu dropdown-menu-right",children:a("ul",{className:"link-list-opt no-bdr",children:a("li",{children:a("a",{href:"#",children:"Mute"})})})})]})}),ue=({status:e})=>l(m.exports.Fragment,{children:[e==="unread"&&a("div",{className:"status unread",children:a("em",{className:"icon ni ni-bullet-fill"})}),e==="sent"&&a("div",{className:"status sent",children:a("em",{className:"icon ni ni-check-circle"})}),e==="delivered"&&a("div",{className:"status delivered",children:a("em",{className:"icon ni ni-check-circle-fill"})}),e==="seen"&&a("div",{className:"status seen",children:a("em",{className:"icon ni ni-check-circle-fill text-info"})})]}),k=({id:e,type:r,icon:i,online:t,name:n,message:s,preview:d,index:f})=>{const h=g(),c=o=>{o.preventDefault()};return m.exports.useEffect(()=>{f===0&&h(X({id:e,type:r}))},[]),a("li",{className:y("chat-item",{"is-unread":(s==null?void 0:s.status)==="unread"}),onClick:c,children:l("div",{className:"chat-link chat-open",children:[l("div",{className:"chat-media user-avatar",children:[i&&a("img",{src:i,alt:n}),typeof t<"u"&&a("span",{className:y("status dot dot-lg",{"dot-gray":!t,"dot-success":t})})]}),l("div",{className:"chat-info",children:[l("div",{className:"chat-from",children:[a("div",{className:"name",style:{maxWidth:"15ch",overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis"},children:n}),s&&a("span",{className:"time",children:O(s.time)})]}),s&&l("div",{className:"chat-context",children:[l("div",{className:"text",children:[s.deleted&&l("p",{children:[a("em",{className:"fas fa-ban"}),a("em",{children:"This message is deleted"})]}),!s.deleted&&l("p",{children:[s.type==="image"&&l("span",{children:[a("i",{className:"fas fa-image"})," Image"]}),s.type==="document"&&l("span",{children:[a("i",{className:"fas fa-file"})," Document"]}),s.type==="text"&&s.text]})]}),!s.deleted&&a(ue,{status:s.status})]}),!d&&a(me,{})]})]})})},pe=()=>{const e=u(t=>t.chat.recent.data.rooms),r=u(t=>t.chat.recent.status);let i=-1;return r==="loading"?a("div",{className:"pt-5 text-center text-muted",children:"Loading chats...."}):a("ul",{className:"chat-list",children:e.map(({last_message:t,...n})=>{if(i++,n.type==="group")return a(k,{id:n.uid,name:n.name,index:i,icon:n.icon,type:"group",message:t?{text:t.content||"",status:t.user_id!==user.id?t.status:null,type:t.type,time:w(t.created_at).unix(),deleted:t.is_deleted}:null},n.uid);const s=n.participants.find(d=>d.id!==(user==null?void 0:user.id));return a(k,{id:n.uid,name:(s==null?void 0:s.name)||"Unknown",icon:s==null?void 0:s.avatar,index:i,type:"individual",message:t?{text:t.content||"",status:t.status,type:t.type,time:w(t.created_at).unix(),deleted:t.is_deleted}:null},n.uid)})})},fe=()=>{const e=u(t=>t.chat.search.data),r=u(t=>t.chat.search.status),i=u(t=>t.chat.search.error);return l("ul",{className:"chat-list",children:[r==="loading"&&a("span",{children:"Searching..."}),r==="error"&&a("span",{className:"text-danger",children:i||"Could not search chats!"}),r==="success"&&l(m.exports.Fragment,{children:[e.groups.map(({icon:t,name:n,uid:s,type:d})=>m.exports.createElement(k,{icon:t,name:n,id:s,type:d,key:s})),e.contacts.map(({id:t,name:n,avatar:s})=>a(k,{name:n,icon:s,id:t,type:"contact"},t))]})]})},ve=()=>{const e=g(),r=u(n=>n.chat.search.searched),i=["super_admin","admin","provider"],t="createChatGroupModal";return m.exports.useEffect(()=>{e(ee())},[e]),l("div",{className:"nk-chat-aside",children:[a(de,{id:t}),a("div",{className:"nk-chat-aside-head",children:a("div",{className:"nk-chat-aside-user",children:l("div",{className:"dropdown",children:[l("span",{className:"dropdown-toggle dropdown-indicator","data-toggle":"dropdown",children:[a("div",{className:"user-avatar",children:(user==null?void 0:user.avatar)&&a("img",{src:user.avatar,alt:user.name})}),a("div",{className:"title",children:"Chats"})]}),i.includes(user.role)&&a("div",{className:"dropdown-menu",children:a("ul",{className:"link-list-opt no-bdr",children:a("li",{children:a("a",{href:"#",onClick:ae(t),children:"Create Group"})})})})]})})}),a(he,{children:l("div",{className:"nk-chat-list",children:[a("h6",{className:"title overline-title-alt",children:"Messages"}),r?a(fe,{}):a(pe,{})]})})]})},P=({label:e})=>e?a("div",{className:"chat-sap",children:a("div",{className:"chat-sap-meta",children:a("span",{children:e})})}):null,ge=({label:e,children:r,bottom:i=!1})=>l(m.exports.Fragment,{children:[!i&&a(P,{label:e}),r,i&&a(P,{label:e})]}),Ne=({id:e,chat:r})=>{const i=g();return a("ul",{className:"chat-msg-more",children:a("li",{children:l("div",{className:"dropdown",children:[a("a",{href:"#",className:"btn btn-icon btn-sm btn-trigger dropdown-toggle","data-toggle":"dropdown",children:a("em",{className:"icon ni ni-more-h"})}),a("div",{className:"dropdown-menu dropdown-menu-sm dropdown-menu-right",children:a("ul",{className:"link-list-opt no-bdr",children:a("li",{children:l("a",{href:"#",onClick:n=>{n.preventDefault(),i(te({chat_id:r,message_id:e})).unwrap().catch(s=>{console.log({error:s}),alert("An error occurred while deleting message")})},children:[a("em",{className:"icon ni ni-trash-fill"})," Delete"]})})})})]})})})},be=({id:e,chat:r,content:i,type:t,deleted:n,received:s})=>l("div",{className:"chat-bubble",children:[l("div",{className:"chat-msg",children:[n&&l("em",{children:[a("em",{className:"fas fa-ban"}),"\xA0This message is deleted"]}),!n&&l(m.exports.Fragment,{children:[t==="image"&&a("img",{src:`/storage/chat/${i}`,className:"w-100",alt:"Unavailable"}),t==="text"&&i,t==="document"&&l("span",{onClick:d=>{d.preventDefault(),window.open(i[0]==="/"?i:`/${i}`)},children:[a("i",{className:"fas fa-file"}),"Document"]})]})]}),!s&&a(Ne,{id:e,chat:r})]});var j={exports:{}},xe=b;b.addTo=Ce;b.parse=Me;b.find=b;var $=2,S=" -\\/:-@\\[-`\\{-\\~",U=/^[A-Z]+$/,_=/\(([^)]+)\)/,ye=/^[^\s]+@[^\s]+$/,we=/@[^\s]+/,B=/[\w._-]+@[\w.-]+[\w]/g,ke=new RegExp("(^|["+S+"])[^"+S+"]","g"),G=new RegExp("["+S+"]","g");function b(e,r){return e?typeof e=="string"?A(e,v(r)):F(e,v(r)):""}function Ce(e,r){return e?typeof e=="string"?De(e,v(r)):Ee(e,v(r)):""}function Me(e,r){return e?typeof e=="string"?I(e,v(r)):L(e,v(r)):{}}function A(e,r){var i,t,n,s=r.length||2;if(n=T(e,r),n)return n;if(e=W(e),!e)return"";if(i=e.match(ke).map(function(c){return c[c.length-1]}),i.length<2)return e.length>s?e.substr(0,s):e;if(t=i.join(""),t.length>=s)return t;for(var d=Y(e),f,h=0;h<d.length;h++)if(d[h].length>=s)return d[h];return f}function F(e,r){var i=[],t,n={},s={},d={},f,h,c=r.length||2;e.forEach(function(p){if(p||(p=""),!d[p]){if(p.length<c){d[p]=[p];return}if(f=T(p,r),f){n[f]=1,d[p]=[f];return}h=Y(p).filter(function(x){return x.length!==c?!1:(n[x]&&(s[x]=1),n[x]=1,!0)}),d[p]=h}});var o=[];for(var Q in d)o.unshift(Q);for(var Z=o.length,C=0;C<Z;C++){h=d[o[C]],i.push(h);for(var N=0;N<h.length;N++)s[h[N]]>0&&(s[h[N]]--,h.splice(N,1))}return t=i.map(function(p){return p.length}),t.length===0?e:Math.min.apply(null,t)===0?(r.length++,F(e,r)):e.map(function(p){return d[p][0]})}function De(e,r){var i=I(e,r);return z(i)}function Ee(e,r){return L(e,r).map(z)}function I(e,r){var i,t,n,s={};return e?(i=T(e,r),i&&(e=e.replace(U,""),e=e.replace(_,"")),r.initials&&(i=r.initials),i||(i=A(e,r)),n=e.match(B),n!=null&&(t=n.pop()),t&&(e=e.replace(t,""),e.trim()==="<"+t+">"&&(e="",i||(i=A(t,r)))),e=e.replace(G," ").trim(),e&&(s.name=e),i&&(s.initials=i),t&&(s.email=t),s):{}}function L(e,r){var i=F(e,r);return e.map(function(t,n){return r.existing[t]=i[n],I(t,r)})}function z(e){return!e.name&&!e.email?e.initials:e.email?e.name?e.name+" ("+e.initials+") <"+e.email+">":e.email+" ("+e.initials+")":e.name+" ("+e.initials+")"}function W(e){return ye.test(e)?e=e.replace(we,""):e=e.replace(B,""),e=e.replace(G," ").trim(),e}function T(e,r){var i;if(r.existing[e])return r.existing[e];if(U.test(e))return e;if(i=e.match(_),i!=null)return i.pop()}var E={};function Y(e){var r,i,t=[];return e=W(e),E[e]?E[e].slice(0):(r=e.split(" "),i=r.map(Se),t=q(i),t=t.sort(function(n,s){return n.length-s.length||t.indexOf(n)-t.indexOf(s)}),E[e]=t,t.slice(0))}function q(e){var r=e.shift(),i,t;return e.length>0?(t=[],i=q(e),r.forEach(function(n){i.forEach(function(s){t.push(n+s)})}),t):r}function Se(e){for(var r=[];e.length;)r.unshift(e),e=e.substr(0,e.length-1);return r}function v(e){return e||(e={length:$}),typeof e=="number"&&(e={length:e}),e.length=Math.max(e.length||0,$),e.existing=e.existing||{},e}(function(e){e.exports=xe})(j);const H=se(j.exports),Ae=({avatar:e,name:r})=>a("div",{className:"chat-avatar",children:l("div",{className:"user-avatar bg-purple",children:[e&&a("img",{src:e,alt:r}),!e&&a("span",{children:H(r).toUpperCase()})]})}),Fe=({avatar:e,received:r,name:i,time:t,children:n})=>l("div",{className:y("chat is-you",{"is-you":r,"is-me":!r}),children:[r&&a(Ae,{name:i,avatar:e}),l("div",{className:"chat-content",children:[a("div",{className:"chat-bubbles",children:n}),(i||t)&&l("ul",{className:"chat-meta",children:[i&&a("li",{children:i}),t&&a("li",{children:t})]})]})]}),Ie=()=>{const e=g(),r=u(c=>c.chat.active.data),[i,t]=m.exports.useState(""),n=m.exports.useRef(null),s=m.exports.useRef(null);return l("div",{className:"nk-chat-editor",children:[l("div",{className:"nk-chat-editor-upload ml-n1",children:[a("a",{href:"#",onClick:c=>{var o;c.preventDefault(),(o=n.current)==null||o.click()},className:"btn btn-sm btn-icon btn-trigger text-primary toggle-opt",children:a("em",{className:"icon ni ni-img-fill"})}),a("a",{href:"#",className:"btn btn-sm btn-icon btn-trigger text-primary toggle-opt",onClick:c=>{var o;c.preventDefault(),(o=s.current)==null||o.click()},children:a("em",{className:"icon ni ni-file"})})]}),a("input",{type:"file",style:{display:"none"},name:"image",onChange:c=>{var o;c.preventDefault(),!(!r||!((o=c.target.files)!=null&&o.length))&&e(M({chat_id:r.uid,type:"image",content:c.target.files[0]})).unwrap().then(()=>{D()})},ref:n,accept:"image/*"}),a("input",{type:"file",style:{display:"none"},name:"doc",ref:s,onChange:c=>{var o;c.preventDefault(),!(!r||!((o=c.target.files)!=null&&o.length))&&e(M({chat_id:r.uid,type:"document",content:c.target.files[0]})).unwrap().then(()=>{D()})}}),a("div",{className:"nk-chat-editor-form",children:a("div",{className:"form-control-wrap",children:a("textarea",{className:"form-control form-control-simple no-resize",rows:1,id:"default-textarea",placeholder:"Type your message...",value:i,onChange:c=>t(c.target.value)})})}),l("ul",{className:"nk-chat-editor-tools g-2",children:[a("li",{children:a("a",{href:"#",className:"btn btn-sm btn-icon btn-trigger text-primary",children:a("em",{className:"icon ni ni-happyf-fill"})})}),a("li",{children:a("button",{type:"button",className:"btn btn-round btn-primary btn-icon",onClick:c=>{c.preventDefault(),!(!i||!r)&&e(M({chat_id:r.uid,content:i,type:"text"})).unwrap().then(()=>{t(()=>""),D()}).catch(o=>console.log({error:o}))},children:a("em",{className:"icon ni ni-send-alt"})})})]})]})},Te=()=>l("ul",{className:"nk-chat-head-tools",children:[a("li",{children:a("a",{href:"#",className:"btn btn-icon btn-trigger text-primary",children:a("em",{className:"icon ni ni-call-fill"})})}),a("li",{children:a("a",{href:"#",className:"btn btn-icon btn-trigger text-primary",children:a("em",{className:"icon ni ni-video-fill"})})}),a("li",{className:"d-none d-sm-block",children:l("div",{className:"dropdown",children:[a("a",{href:"#",className:"dropdown-toggle btn btn-icon btn-trigger text-primary","data-toggle":"dropdown",children:a("em",{className:"icon ni ni-setting-fill"})}),a("div",{className:"dropdown-menu dropdown-menu-right",children:l("ul",{className:"link-list-opt no-bdr",children:[a("li",{children:l("a",{className:"dropdown-item",href:"#",children:[a("em",{className:"icon ni ni-archive"}),a("span",{children:"Make as Archive"})]})}),a("li",{children:l("a",{className:"dropdown-item",href:"#",children:[a("em",{className:"icon ni ni-cross-c"}),a("span",{children:"Remove Conversion"})]})}),a("li",{children:l("a",{className:"dropdown-item",href:"#",children:[a("em",{className:"icon ni ni-setting"}),a("span",{children:"More Options"})]})})]})})]})}),a("li",{className:"mr-n1 mr-md-n2",children:a("a",{href:"#",className:"btn btn-icon btn-trigger text-primary chat-profile-toggle",children:a("em",{className:"icon ni ni-alert-circle-fill"})})})]}),Re=()=>a("div",{className:"nk-chat-head-search",children:a("div",{className:"form-group",children:l("div",{className:"form-control-wrap",children:[a("div",{className:"form-icon form-icon-left",children:a("em",{className:"icon ni ni-search"})}),a("input",{type:"text",className:"form-control form-round",id:"chat-search",placeholder:"Search in Conversation"})]})})}),Pe=()=>{const e=u(i=>i.chat.active.data);if(u(i=>i.chat.active.status)==="success"&&e){const i=e.participants.find(s=>s.id!==user.id),t=(e.type==="group"?e.name:i==null?void 0:i.name)||"Unlabeled Conversation",n=e.type==="group"?e.icon:i==null?void 0:i.avatar;return l("div",{className:"nk-chat-head",children:[l("ul",{className:"nk-chat-head-info",children:[a("li",{className:"nk-chat-body-close",children:a("a",{href:"#",className:"btn btn-icon btn-trigger nk-chat-hide ml-n1",children:a("em",{className:"icon ni ni-arrow-left"})})}),a("li",{className:"nk-chat-head-user",children:l("div",{className:"user-card",children:[l("div",{className:"user-avatar bg-purple",children:[n&&a("img",{src:n,alt:t}),!n&&a("span",{children:H(t).toUpperCase()})]}),l("div",{className:"user-info",children:[a("div",{className:"lead-text",children:t}),e.type==="individual"&&l("div",{className:"sub-text",children:[a("span",{className:"d-none d-sm-inline mr-1",children:"Active "}),"35m ago"]})]})]})})]}),a(Te,{}),a(Re,{})]})}return null},$e=({children:e})=>{const r=u(n=>n.chat.active.data),i=u(n=>n.chat.active.status),t=u(n=>n.chat.active.error);return a("div",{className:"nk-chat-body",children:i==="success"&&r?l(m.exports.Fragment,{children:[a(Pe,{}),l("div",{className:"nk-chat-panel","data-simplebar":"init",children:[l("div",{className:"simplebar-wrapper",style:{margin:"-20px -28px"},children:[a("div",{className:"simplebar-height-auto-observer-wrapper",children:a("div",{className:"simplebar-height-auto-observer"})}),a("div",{className:"simplebar-mask",children:a("div",{className:"simplebar-offset",style:{right:0,bottom:0},children:a("div",{className:"simplebar-content-wrapper",style:{height:"100%",overflow:"hidden scroll"},children:a("div",{className:"simplebar-content",style:{padding:"20px 28px"},id:"messagesWrapperContainer",children:e})})})}),a("div",{className:"simplebar-placeholder",style:{width:"auto",height:"776px"}})]}),a("div",{className:"simplebar-track simplebar-horizontal",style:{visibility:"hidden"},children:a("div",{className:"simplebar-scrollbar",style:{width:0,display:"none"}})}),a("div",{className:"simplebar-track simplebar-vertical",style:{visibility:"visible"},children:a("div",{className:"simplebar-scrollbar",style:{height:"65px",transform:"translate3d(0px, 0px, 0px)",display:"block"}})})]}),a(Ie,{})]}):l("div",{className:"container text-center w-full pt-5 mt-5 text-muted",children:[i==="idle"&&a("span",{children:"Select a chat from sidebar to start messaging."}),i==="loading"&&a("span",{children:"Fetching chat messages..."}),i==="error"&&a("strong",{className:"text-danger",children:t||"An error occurred while loading chat!"})]})})},je=()=>{const e=u(t=>t.chat.active.data),r=u(t=>t.chat.active.status),i=m.exports.useMemo(()=>ie((e==null?void 0:e.messages)||[]),[e]);return a($e,{children:r==="success"&&e&&Object.entries(i).map(([t,n])=>a(ge,{label:w(t).format("Do MMM, YYYY"),children:n.map(s=>s.type==="event"?null:a(Fe,{name:s.user.name,avatar:s.user.avatar,received:s.user.id!==user.id,time:w(s.created_at).format("h:mm A"),children:a(be,{id:s.id,chat:e.uid,type:s.type,received:s.user_id!==user.id,content:s.is_deleted?"":s.content||"",deleted:s.is_deleted})},s.id))},t))})},Be=()=>{const e=g(),r=u(i=>i.chat.recent.data.ids);return m.exports.useEffect(()=>(r.forEach(i=>{const t=`chats.${i}`;console.log(t),Echo.private(t).listen(".message.created",n=>{console.log("Received event of new message creation"),console.log(n),e(re({chat_id:n.chat_id,message:n.message}))}).listen(".message.deleted",n=>{console.log("Received event of a message deletion"),console.log(n),e(ne(n))}).listen(".group.updated",n=>{console.log("Received event of group details updation"),console.log(n)})}),()=>{r.forEach(i=>Echo.leave(`chat.${i}`))}),[e,r]),l("div",{className:"nk-chat",children:[a(ve,{}),a(je,{})]})};export{Be as default};
